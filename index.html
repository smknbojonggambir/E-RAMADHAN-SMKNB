<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#065f46">
<title>E-RAMADHAN SMKNB</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #059669; /* Emerald 600 */
    --primary-dark: #064e3b;
    --primary-light: #d1fae5;
    --accent: #d97706; /* Gold */
    --bg-body: #f0fdf4;
    --surface: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --border: #e2e8f0;
    --radius-l: 24px;
    --radius-m: 16px;
    --radius-s: 12px;
    --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
    --shadow-card: 0 4px 6px -1px rgba(0,0,0,0.05);
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body { 
    font-family: 'Plus Jakarta Sans', sans-serif; 
    background-color: var(--bg-body);
    background-image: radial-gradient(at 0% 0%, rgba(5, 150, 105, 0.1) 0px, transparent 50%), 
                      radial-gradient(at 100% 100%, rgba(217, 119, 6, 0.1) 0px, transparent 50%);
    background-attachment: fixed;
    margin: 0; padding: 0; 
    color: var(--text-main); 
    padding-bottom: 80px; 
    min-height: 100vh;
  }

  /* HEADER MODERN CURVED */
  .header {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    padding: 40px 20px 60px; 
    text-align: center; 
    color: white;
    border-radius: 0 0 40px 40px; 
    position: relative;
    box-shadow: 0 10px 30px rgba(6, 78, 59, 0.25);
    overflow: hidden;
  }
  
  /* Hiasan background header */
  .header::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
    pointer-events: none;
  }

  .logo { 
    width: 85px; height: 85px; 
    background: white; 
    border-radius: 50%; 
    padding: 5px; 
    margin-bottom: 12px; 
    object-fit: contain;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border: 3px solid rgba(255,255,255,0.3);
  }

  .header h2 { 
    margin: 0; font-size: 1.4rem; font-weight: 800; letter-spacing: 0.5px; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .welcome-badge {
    margin-top: 10px;
    display: inline-block;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(4px);
    padding: 8px 16px;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.2);
    line-height: 1.4;
  }

  /* CONTAINER */
  .container { 
    max-width: 480px; 
    margin: -40px auto 0; 
    padding: 0 20px; 
    position: relative; 
    z-index: 10; 
  }

  /* CARDS */
  .card {
    background: var(--surface); 
    padding: 24px; 
    border-radius: var(--radius-l);
    box-shadow: var(--shadow-soft); 
    margin-bottom: 20px; 
    border: 1px solid white;
    animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; }

  /* FORMS */
  label { 
    font-size: 0.75rem; font-weight: 700; color: var(--text-muted); 
    margin-bottom: 6px; display: block; text-transform: uppercase; letter-spacing: 0.5px; 
  }

  select, input, button {
    width: 100%; padding: 16px; 
    border-radius: var(--radius-m); 
    border: 1px solid var(--border);
    font-family: inherit; font-size: 0.95rem; 
    background: #f8fafc; outline: none;
    transition: all 0.2s ease; margin-bottom: 15px;
    appearance: none; /* Bersihkan style bawaan browser */
  }

  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 18px;
  }

  select:focus, input:focus { 
    border-color: var(--primary); 
    background: #fff; 
    box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1); 
  }

  /* BUTTONS */
  button {
    background: linear-gradient(to right, var(--primary), var(--primary-dark));
    color: white; border: none; font-weight: 700;
    cursor: pointer; 
    box-shadow: 0 8px 15px rgba(5, 150, 105, 0.2);
    transform: translateY(0);
    letter-spacing: 0.5px;
  }
  button:active { transform: scale(0.98); box-shadow: 0 4px 6px rgba(5, 150, 105, 0.2); }
  button:disabled { background: #cbd5e1; box-shadow: none; cursor: default; }
  
  .btn-outline { 
    background: transparent; border: 2px solid var(--border); 
    color: var(--text-muted); box-shadow: none; 
  }
  .btn-outline:hover { background: #f1f5f9; color: var(--text-main); border-color: #cbd5e1; }

  /* ACTIVITY GROUPS */
  .act-group {
    background: #fff; 
    border: 1px solid var(--border); 
    padding: 16px;
    border-radius: var(--radius-m); 
    margin-bottom: 12px; 
    position: relative; 
    transition: transform 0.2s;
  }
  .act-group:focus-within {
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.08);
  }
  .act-group::before {
    content: ''; position: absolute; left: 0; top: 12px; bottom: 12px; width: 4px;
    background: var(--accent); border-radius: 0 4px 4px 0;
  }
  .act-group b { display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--text-main); }
  
  /* Inputs inside groups */
  .act-group select, .act-group input { margin-bottom: 8px; font-size: 0.9rem; padding: 12px; }
  .act-group input { background: transparent; border: none; border-bottom: 1px dashed #cbd5e1; border-radius: 0; padding-left: 0; }
  .act-group input:focus { box-shadow: none; border-bottom-color: var(--primary); }

  /* GPS BOX */
  .gps-box {
    display: flex; align-items: center; gap: 15px; padding: 16px;
    background: var(--primary-light); 
    border: 1px solid #6ee7b7; 
    border-radius: var(--radius-m);
    color: var(--primary-dark); 
    font-size: 0.85rem; font-weight: 600; 
    margin-bottom: 20px;
  }
  .gps-loading { animation: pulse 2s infinite; }
  .gps-error { background: #fef2f2; border-color: #fecaca; color: #991b1b; }
  
  /* FILE UPLOAD */
  input[type="file"] { 
    padding: 30px 10px; 
    background: #f8fafc; 
    border: 2px dashed #94a3b8; 
    text-align: center; 
    color: #64748b;
    cursor: pointer;
  }
  input[type="file"]:hover { border-color: var(--primary); background: #f0fdf4; }

  /* ADMIN DASHBOARD LIST */
  .row-data {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 0; border-bottom: 1px solid #f1f5f9; cursor: pointer;
    transition: background 0.2s;
  }
  .row-data:hover { background: #f8fafc; padding-left: 5px; padding-right: 5px; border-radius: 8px; }
  .row-data:last-child { border-bottom: none; }
  
  .avatar {
    width: 40px; height: 40px; background: #e2e8f0; border-radius: 50%;
    display: flex; justify-content: center; align-items: center; 
    font-size: 1.2rem; margin-right: 12px; flex-shrink: 0;
  }
  .poin-badge {
    background: var(--primary-light); color: var(--primary-dark);
    padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700;
  }

  /* FOOTER */
  .footer-dev {
    text-align: center; font-size: 0.75rem; color: #94a3b8; margin-top: 40px;
    padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.05);
  }
  .footer-dev span {
    display: inline-block; padding: 6px 12px; background: white; 
    border-radius: 20px; border: 1px solid #e2e8f0; margin-bottom: 10px;
    font-weight: 500; transition: all 0.2s;
  }
  .footer-dev span:hover { border-color: var(--primary); color: var(--primary); }
  
  .footer-dev a { 
    color: var(--primary); text-decoration: none; font-weight: 700; 
    position: relative;
  }
  
  /* MODAL (BOTTOM SHEET STYLE ON MOBILE) */
  .modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
    z-index: 100; display: none; align-items: flex-end; justify-content: center;
    transition: opacity 0.3s;
  }
  
  .modal-content {
    background: white; width: 100%; max-width: 500px; 
    padding: 30px;
    border-radius: 30px 30px 0 0; /* Rounded top only for bottom sheet feel */
    max-height: 85vh; overflow-y: auto;
    position: relative;
    animation: slideUpModal 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
  }

  /* Desktop View Modal Adjustment */
  @media (min-width: 500px) {
    .modal { align-items: center; }
    .modal-content { border-radius: 24px; animation: popIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
  }

  /* UTILS & ANIMATION */
  .hidden { display: none; }
  @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }
  @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

</style>
</head>
<body>

<div class="header">
  <img src="https://raw.githubusercontent.com/smknbojonggambir/E-RAMADHAN-SMKNB/main/LOGO.png" class="logo" alt="Logo">
  <h2>E-RAMADHAN SMKNB</h2>
  <div class="welcome-badge">
    "Yuk, Catat Amal Ibadahmu Hari Ini!"<br>
    <span style="font-size:0.75rem; opacity:0.8; font-weight:400;">Isi jurnal ibadahmu dengan jujur ya!</span>
  </div>
</div>

<div class="container">
  
  <div id="panel-siswa">
    
    <div class="card">
      <h3 style="text-align:center; color:var(--primary-dark); margin-top:0;">üìù Identitas Siswa</h3>
      
      <label>Pilih Kelompok</label>
      <select id="pKelas" onchange="loadNama()">
        <option>Memuat Data...</option>
      </select>
      
      <div id="areaNama" class="hidden">
        <label>Nama Lengkap</label>
        <select id="pNama"><option value="">-- Pilih Nama Kamu --</option></select>
        
        <button onclick="bukaForm()" style="margin-top:10px; display:flex; align-items:center; justify-content:center; gap:8px;">
          LANJUT ISI LAPORAN <span>üëâ</span>
        </button>
      </div>
    </div>

    <div id="formIbadah" class="hidden">
      <div class="card">
        <h3 style="color:var(--primary); margin-top:0;">üìç Lokasi & Aktivitas</h3>
        
        <div id="gps-box" class="gps-box gps-loading">
          <span style="font-size:1.5rem">üõ∞Ô∏è</span>
          <div>
            <div style="font-size:0.75rem; color:#047857; opacity:0.8;">STATUS GPS</div>
            <span id="gps-text">Sedang mencari titik lokasi...</span>
          </div>
        </div>

        <div class="act-group">
          <b>1. Puasa Hari Ini?</b>
          <select id="puasa">
            <option value="Ya">‚úÖ Ya, Alhamdulillah Full</option>
            <option value="Setengah">üåó Setengah Hari (Dzuhur)</option>
            <option value="Tidak">‚ùå Tidak Puasa</option>
          </select>
          <input id="k_puasa" placeholder="Tulis catatan jika ada...">
        </div>

        <div class="act-group">
          <b>2. Shalat Wajib 5 Waktu?</b>
          <select id="shalat">
            <option value="Ya">‚úÖ Lengkap (Subuh-Isya)</option>
            <option value="Bolong">‚ö†Ô∏è Ada yang terlewat</option>
            <option value="Tidak">‚ùå Tidak Shalat</option>
          </select>
          <input id="k_shalat" placeholder="Shalat apa yang tertinggal?">
        </div>

        <div class="act-group">
          <b>3. Shalat Tarawih?</b>
          <select id="tarawih">
            <option value="Ya">‚úÖ Ya, Melaksanakan</option>
            <option value="Tidak">‚ùå Tidak / Berhalangan</option>
          </select>
          <input id="k_tarawih" placeholder="Catatan tambahan">
        </div>

        <div class="act-group">
          <b>4. Tadarus Al-Qur'an?</b>
          <select id="tadarus">
            <option value="Ya">‚úÖ Ya, Membaca</option>
            <option value="Tidak">‚ùå Belum sempat</option>
          </select>
          <input id="k_tadarus" placeholder="Surat apa / Juz berapa?">
        </div>

        <div class="act-group">
          <b>5. Infaq / Sedekah?</b>
          <select id="sedekah">
            <option value="Ya">‚úÖ Ya, Bersedekah</option>
            <option value="Tidak">‚ùå Tidak hari ini</option>
          </select>
          <input id="k_sedekah" placeholder="Bentuk sedekah...">
        </div>

        <div class="act-group" style="border-left-color: var(--primary); background: #f0fdf4;">
          <b>üì∏ Foto Bukti Kegiatan</b>
          <p style="font-size:0.75rem; color:#64748b; margin:-5px 0 10px;">Selfie saat kegiatan atau foto di lokasi.</p>
          <input type="file" id="foto" accept="image/*" capture="environment">
        </div>

        <button onclick="kirim()" id="btnKirim" style="font-size:1.1rem; padding:18px; margin-top:10px;">
          üöÄ KIRIM LAPORAN
        </button>
      </div>
    </div>
  </div>

  <div id="panel-login-admin" class="hidden">
    <div class="card" style="text-align:center; padding: 40px 20px;">
      <div style="font-size:3rem; margin-bottom:10px;">üîê</div>
      <h3 style="color:var(--primary)">Login Guru / Admin</h3>
      <p style="font-size:0.85rem; color:#64748b; margin-bottom:20px;">Masukkan password untuk mengakses data monitoring.</p>
      
      <input type="password" id="adminPass" placeholder="Ketik Password..." style="text-align:center; font-size:1.1rem; letter-spacing:2px;">
      
      <div style="display:flex; gap:10px;">
        <button onclick="modeSiswa()" class="btn-outline">Batal</button>
        <button onclick="loginAdmin()">MASUK</button>
      </div>
    </div>
  </div>

  <div id="dashboard-admin" class="hidden">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #f1f5f9; padding-bottom:15px;">
        <h3 style="margin:0;">üë®‚Äçüè´ Monitor Data</h3>
        <button onclick="location.reload()" style="width:auto; padding:8px 16px; font-size:0.8rem; background:#ef4444; box-shadow:none;">Logout</button>
      </div>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div>
          <label>Tanggal</label>
          <input type="date" id="admDate" onchange="loadRekap()" style="margin:0;">
        </div>
        <div>
          <label>Kelompok</label>
          <select id="admKelas" onchange="loadRekap()" style="margin:0;">
            <option value="Semua">Semua Kelompok</option>
          </select>
        </div>
      </div>
      
      <div style="background:#f1f5f9; padding:12px; border-radius:12px; margin-top:15px; text-align:center;">
        <span style="font-size:0.8rem; color:#64748b;">Total Laporan Masuk</span>
        <div style="font-size:1.5rem; font-weight:800; color:var(--primary);" id="totalLapor">0</div>
      </div>
    </div>

    <div class="card" style="padding:15px;">
      <div id="list-rekap">
        <div style="text-align:center; padding:30px; color:#94a3b8;">
          <div style="font-size:2rem; opacity:0.5; margin-bottom:10px;">üìÖ</div>
          Pilih tanggal untuk melihat data.
        </div>
      </div>
    </div>
  </div>

  <div class="footer-dev">
    <span onclick="modeAdmin()" style="cursor:pointer;">üîê Login Admin</span><br>
    <div style="margin-top:5px;">
      Developer Program <a href="https://www.kangruli.web.id" target="_blank">Kang Ruli</a>
    </div>
  </div>

</div>

<div id="modalDetail" class="modal">
  <div class="modal-content">
    <div style="width:50px; height:5px; background:#e2e8f0; border-radius:10px; margin:0 auto 20px;"></div>
    
    <div style="text-align:center; margin-bottom:20px;">
      <h3 id="mNama" style="margin:0; color:var(--primary); font-size:1.3rem;">Nama Siswa</h3>
      <span id="mKelas" style="background:#f1f5f9; padding:4px 12px; border-radius:20px; font-size:0.8rem; color:#64748b; font-weight:600; display:inline-block; margin-top:5px;">Kelas</span>
    </div>

    <div id="mBody" style="background:#f8fafc; padding:20px; border-radius:16px; border:1px solid #e2e8f0; font-size:0.95rem; line-height:1.8;">
      </div>
    
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:20px;">
      <a id="mFoto" href="#" target="_blank" style="text-align:center; padding:12px; background:var(--accent); color:white; text-decoration:none; border-radius:12px; font-weight:600; font-size:0.9rem;">
        üì∏ Lihat Foto
      </a>
      <a id="mMap" href="#" target="_blank" style="text-align:center; padding:12px; background:#3b82f6; color:white; text-decoration:none; border-radius:12px; font-weight:600; font-size:0.9rem;">
        üó∫Ô∏è Cek Lokasi
      </a>
    </div>
    
    <button onclick="document.getElementById('modalDetail').style.display='none'" class="btn-outline" style="margin-top:15px; border:none; background:#f1f5f9;">Tutup Detail</button>
  </div>
</div>

<script>
// LOGIC TETAP SAMA SEPERTI YANG ANDA BERIKAN
const API = "https://script.google.com/macros/s/AKfycbzRLc1E0n-rEs9bmscPLe5aGbQbJEyBjHB5l-CQ9Fnhxvct2XnYhWaHI-dyci1kesumTA/exec";
let DATA_SISWA = {}, USER_LAT = '', USER_LONG = '';

window.onload = function() {
  document.getElementById('admDate').valueAsDate = new Date();
  fetch(API, {method: "POST", body: JSON.stringify({action: "get_siswa"})})
  .then(r=>r.json()).then(res => {
    if(res.status) {
      DATA_SISWA = res.data;
      const s = document.getElementById('pKelas'), sAdm = document.getElementById('admKelas');
      s.innerHTML = '<option value="">-- Pilih Kelompok --</option>';
      Object.keys(DATA_SISWA).sort().forEach(k => {
        s.innerHTML += `<option value="${k}">${k}</option>`;
        sAdm.innerHTML += `<option value="${k}">${k}</option>`;
      });
    }
  });
}

function modeAdmin() {
  document.getElementById('panel-siswa').classList.add('hidden');
  document.getElementById('panel-login-admin').classList.remove('hidden');
  window.scrollTo(0,0);
}
function modeSiswa() {
  document.getElementById('panel-login-admin').classList.add('hidden');
  document.getElementById('panel-siswa').classList.remove('hidden');
  window.scrollTo(0,0);
}

function loadNama() {
  const k = document.getElementById('pKelas').value;
  const n = document.getElementById('pNama');
  if(k && DATA_SISWA[k]) {
    n.innerHTML = '<option value="">-- Pilih Nama --</option>';
    DATA_SISWA[k].sort((a,b)=>a.nama.localeCompare(b.nama)).forEach(x => {
      n.innerHTML += `<option value="${x.user}" data-n="${x.nama}">${x.nama}</option>`;
    });
    document.getElementById('areaNama').classList.remove('hidden');
  }
}

function bukaForm(){
  const f = document.getElementById('formIbadah');
  f.classList.remove('hidden');
  f.scrollIntoView({behavior: "smooth"});
  cariLokasi();
}

function cariLokasi() {
  const box = document.getElementById('gps-box'), txt = document.getElementById('gps-text');
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        USER_LAT = pos.coords.latitude; USER_LONG = pos.coords.longitude;
        box.style.background = "#d1fae5"; box.style.borderColor="#34d399"; box.classList.remove('gps-loading');
        txt.innerHTML = "Lokasi Terkunci: <b>"+USER_LAT.toFixed(5)+", "+USER_LONG.toFixed(5)+"</b>";
      },
      (err) => {
        box.className = "gps-box gps-error"; txt.innerText = "Gagal Deteksi Lokasi. Pastikan GPS Aktif!";
        USER_LAT = "Error"; USER_LONG = "Error";
      }, { timeout: 10000, enableHighAccuracy: true }
    );
  }
}

async function kirim() {
  const f = document.getElementById('foto');
  if(!document.getElementById('pNama').value) return alert("Pilih Nama dulu!");
  if(f.files.length === 0) return alert("Wajib lampirkan Foto!");
  
  if(!confirm("Kirim Laporan sekarang?")) return;
  const btn = document.getElementById('btnKirim');
  const txt = btn.innerText; btn.innerText = "‚è≥ Mengirim..."; btn.disabled = true;

  const r = new FileReader();
  r.readAsDataURL(f.files[0]);
  r.onload = async function() {
    const d = {
      action:'simpan',
      username: document.getElementById('pNama').value,
      nama: document.querySelector('#pNama option:checked').getAttribute('data-n'),
      kelas: document.getElementById('pKelas').value,
      foto: r.result, lat: USER_LAT, long: USER_LONG,
      puasa: document.getElementById('puasa').value, ket_puasa: document.getElementById('k_puasa').value,
      shalat: document.getElementById('shalat').value, ket_shalat: document.getElementById('k_shalat').value,
      tarawih: document.getElementById('tarawih').value, ket_tarawih: document.getElementById('k_tarawih').value,
      tadarus: document.getElementById('tadarus').value, ket_tadarus: document.getElementById('k_tadarus').value,
      sedekah: document.getElementById('sedekah').value, ket_sedekah: document.getElementById('k_sedekah').value,
    };
    try {
      const req = await fetch(API, {method:'POST', body:JSON.stringify(d)});
      const res = await req.json();
      if(res.status) { alert("Berhasil! Poin: "+res.poin); location.reload(); }
      else throw new Error();
    } catch (e) { alert("Gagal Kirim. Coba lagi."); btn.disabled=false; btn.innerText=txt; }
  }
}

async function loginAdmin() {
  const p = document.getElementById('adminPass').value;
  const btn = document.querySelector('#panel-login-admin button:last-child');
  const txt = btn.innerText; btn.innerText = "Cek..."; btn.disabled=true;
  try {
    const r = await fetch(API, {method:'POST', body:JSON.stringify({action:'login_admin', pass:p})});
    const res = await r.json();
    if(res.status) {
      document.getElementById('panel-login-admin').classList.add('hidden');
      document.getElementById('dashboard-admin').classList.remove('hidden');
      loadRekap();
    } else { alert("Password Salah!"); }
  } catch(e){ alert("Error Koneksi"); }
  btn.innerText = txt; btn.disabled=false;
}

async function loadRekap() {
  const tgl = document.getElementById('admDate').value;
  const kls = document.getElementById('admKelas').value;
  const list = document.getElementById('list-rekap');
  list.innerHTML = '<div style="text-align:center; padding:20px; color:#64748b;">‚è≥ Memuat data...</div>';
  
  try {
    const r = await fetch(API, {method:'POST', body:JSON.stringify({action:'get_rekap', tanggal:tgl, kelas:kls})});
    const res = await r.json();
    list.innerHTML = ''; document.getElementById('totalLapor').innerText = res.data.length;
    
    if(res.data.length === 0) { list.innerHTML = '<div style="text-align:center; padding:30px; color:#94a3b8;">Tidak ada data laporan.</div>'; return; }
    
    res.data.forEach(d => {
      const raw = JSON.stringify(d).replace(/"/g, '"');
      list.innerHTML += `
        <div class="row-data" onclick='bukaDetail(${JSON.stringify(raw)})'>
          <div style="display:flex; align-items:center;">
            <div class="avatar">${d.foto.length>5 ? 'üì∑' : 'üë§'}</div>
            <div>
              <div style="font-weight:700; font-size:0.95rem; color:var(--text-main);">${d.nama}</div>
              <div style="font-size:0.75rem; color:#64748b;">${d.kelas} ‚Ä¢ ${d.waktu.split(' ')[1]}</div>
            </div>
          </div>
          <div class="poin-badge">${d.poin} Poin</div>
        </div>`;
    });
  } catch(e) { list.innerHTML = 'Gagal memuat.'; }
}

function bukaDetail(jsonStr) {
  const obj = JSON.parse(jsonStr), d = obj.detail;
  document.getElementById('mNama').innerText = obj.nama;
  document.getElementById('mKelas').innerText = obj.kelas;
  document.getElementById('mBody').innerHTML = `
    <div style="margin-bottom:8px"><b>Puasa:</b> ${d[4]} <br><small style="color:#64748b">${d[5]||'-'}</small></div>
    <div style="margin-bottom:8px"><b>Shalat:</b> ${d[6]} <br><small style="color:#64748b">${d[7]||'-'}</small></div>
    <div style="margin-bottom:8px"><b>Tarawih:</b> ${d[8]} <br><small style="color:#64748b">${d[9]||'-'}</small></div>
    <div style="margin-bottom:8px"><b>Tadarus:</b> ${d[10]} <br><small style="color:#64748b">${d[11]||'-'}</small></div>
    <div><b>Sedekah:</b> ${d[12]} <br><small style="color:#64748b">${d[13]||'-'}</small></div>`;
    
  const btnFoto = document.getElementById('mFoto'), btnMap = document.getElementById('mMap');
  btnFoto.style.display = (obj.foto && obj.foto.length > 5) ? 'block' : 'none'; btnFoto.href = obj.foto;
  
  if(obj.lat && obj.long && obj.lat != '-' && obj.lat != 'Error') {
    btnMap.style.display = 'block';
    btnMap.href = 'https://www.google.com/maps?q=' + obj.lat + ',' + obj.long;
  } else { btnMap.style.display = 'none'; }
  
  document.getElementById('modalDetail').style.display = 'flex';
}
</script>
</body>
</html>
