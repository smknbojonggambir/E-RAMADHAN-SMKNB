<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>E-RAMADHAN SMKNB</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  font-family:Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
  padding:20px;
}
.card{
  background:white;
  color:black;
  padding:20px;
  border-radius:15px;
  width:350px;
  margin:auto;
}
button{
  padding:10px;
  width:100%;
  background:#203a43;
  color:white;
  border:none;
}
</style>
</head>

<body>

<h2>ðŸŒ™ E-RAMADHAN SMKNB</h2>

<div class="card" id="loginBox">
<input id="u" placeholder="Username"><br><br>
<input id="p" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">
<div class="card">
<select id="puasa"><option>Ya</option><option>Tidak</option></select><br><br>
<select id="shalat"><option>Lengkap</option><option>Tidak Lengkap</option></select><br><br>
<select id="tarawih"><option>Ya</option><option>Tidak</option></select><br><br>
<select id="tadarus"><option>Ya</option><option>Tidak</option></select><br><br>
<select id="sedekah"><option>Ya</option><option>Tidak</option></select><br><br>
<button onclick="simpan()">Simpan</button>
</div>

<div class="card" id="dashboard" style="display:none;">
<h3>Ranking</h3>
<canvas id="chart"></canvas>
</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzs0eBymHVKfDsBugSad10ZwGLxSU9M8q1HtJNdzSSCpJ4weAZSc3P1FUTanGBV0AA0/exec";

let user={};

async function login(){
  const res = await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      username:u.value,
      password:p.value
    })
  });

  const data = await res.json();

  if(data.status){
    user=data;
    loginBox.style.display="none";
    app.style.display="block";
    if(data.role=="admin") loadChart();
  } else alert("Login gagal");
}

async function simpan(){
  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"simpan",
      username:user.nama,
      nama:user.nama,
      kelas:user.kelas,
      puasa:puasa.value,
      shalat:shalat.value,
      tarawih:tarawih.value,
      tadarus:tadarus.value,
      sedekah:sedekah.value
    })
  });
  alert("Berhasil disimpan");
}

async function loadChart(){
  const res = await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({action:"ranking"})
  });

  const data = await res.json();

  new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:Object.keys(data),
      datasets:[{data:Object.values(data)}]
    }
  });
}
</script>

</body>
</html>
