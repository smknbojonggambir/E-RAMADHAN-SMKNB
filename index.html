<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-RAMADHAN SMKNB 2026</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Segoe UI;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
  padding:20px;
}
.card{
  background:white;
  color:#333;
  padding:20px;
  border-radius:15px;
  margin:15px auto;
  max-width:400px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:8px 0;
}
button{
  background:#203a43;
  color:white;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>ðŸŒ™ E-RAMADHAN SMKNB 2026</h2>

<div class="card" id="loginBox">
  <h3>Login</h3>
  <input id="u" placeholder="Username">
  <input id="p" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="app" style="display:none;">

<div class="card">
<h3>Laporan Ibadah</h3>

<select id="puasa">
<option>Ya</option>
<option>Tidak</option>
</select>

<select id="shalat">
<option>Lengkap</option>
<option>Tidak Lengkap</option>
</select>

<select id="tarawih">
<option>Ya</option>
<option>Tidak</option>
</select>

<select id="tadarus">
<option>Ya</option>
<option>Tidak</option>
</select>

<select id="sedekah">
<option>Ya</option>
<option>Tidak</option>
</select>

<button onclick="simpan()">Simpan</button>

</div>

<div class="card" id="dashboard" style="display:none;">
<h3>Ranking</h3>
<canvas id="chart"></canvas>
</div>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycby4vHWTduc7EgtSdviuhHdqsRlAoYqAi18EWmjrM97GIL_RdKAL2J8q3eyLyG_7mm8X/exec";
let user={};

async function login(){
try{
const res=await fetch(API_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
action:"login",
username:u.value,
password:p.value
})
});
if(!res.ok) throw new Error();
const data=await res.json();

if(data.status){
user=data;
loginBox.style.display="none";
app.style.display="block";
if(data.role=="admin"){
dashboard.style.display="block";
loadChart();
}
}else{
alert("Login gagal");
}
}catch(err){
alert("Server tidak merespon");
}
}

async function simpan(){
try{
await fetch(API_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
action:"simpan",
username:user.username,
nama:user.nama,
kelas:user.kelas,
puasa:puasa.value,
shalat:shalat.value,
tarawih:tarawih.value,
tadarus:tadarus.value,
sedekah:sedekah.value
})
});
alert("Berhasil disimpan");
}catch{
alert("Gagal kirim data");
}
}

async function loadChart(){
const res=await fetch(API_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({action:"ranking"})
});
const data=await res.json();

new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:Object.keys(data),
datasets:[{
label:"Total Poin",
data:Object.values(data)
}]
},
options:{responsive:true}
});
}
</script>

</body>
</html>
